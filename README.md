# ðŸ§¬ Spatial Transcriptomics Pipeline

**Author:** David Carro Vazquez  
**Affiliation:** Department of Orthopedic Surgery, University of California San Francisco (UCSF)  
**Date:** April 2025  

---

## ðŸ“– Overview

This repository contains a reproducible **spatial transcriptomics analysis pipeline** developed for the study of murine knee joint tissues, including cartilage (femur and tibia), synovium, infrapatellar fat pad (IPFP), meniscus, and subchondral bone.  

The workflow integrates multiple samples across experimental conditions (age, sex, and injury) and performs:

- **SCTransform normalization** with batch correction across Visium slides (`Run` variable)  
- **Dimensional reduction:** PCA and UMAP  
- **Clustering and annotation** of tissue-specific regions  
- **Pseudobulk differential expression (DE)** analysis using **MAST** and **DESeq2**  
- **Aging signature derivation** from principal component loadings associated with age  
- **Quality control summaries** and **variance decomposition** per tissue type  

---

## ðŸ“‚ Data Format and Structure

Each sample consists of two complementary data types:

1. **Gene expression data**  
   - Stored in `.h5` files generated by 10x Genomics (`{SampleID}_filtered_feature_bc_matrix.h5`)  
   - Contains the raw count matrix for all detected barcodes (spatial spots)

2. **Barcode metadata Excel files**  
   - Located in `/data/` and organized by **knee subregion** (e.g., cartilage femur, synovium, meniscus, fat pad, subchondral bone)
   - Each Excel file follows this structure:
     - **Column 1:** Barcodes  
     - **Subsequent columns:** Metadata and variables describing region identity, sample ID, age group, injury type, or slide origin  

These Excel metadata tables are linked to the `.h5` expression matrices in the R code to merge **gene expression data with spatial region annotations**, enabling region-specific downstream analyses.

---

## ðŸ§° Requirements

- **R version:** â‰¥ 4.3  
- **Recommended environment:** RStudio or VS Code  
- **Core packages:**  
  `Seurat`, `sctransform`, `Matrix`, `dplyr`, `ggplot2`, `EnhancedVolcano`, `MAST`, `DESeq2`, `kableExtra`

To install missing dependencies:

```r
source("install_packages.R")
